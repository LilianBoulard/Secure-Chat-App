# Node Registering Service

## Important note

The system is still being designed !
Many features are lacking, and it is not secure to use it in production for now.
Come back in a few weeks for the final version of the project.

## Setup

The API is based on a Docker-hosted server and database.
You will therefore need to have Docker installed on your host.

First setup the database by modifying the DB's password in the file `nodes_registry_db/docker-composer.yml`, then running the `build_database.bat` script.
Docker's commands are cross-platform, meaning if you're not on Windows you can run the .bat's commands anyway.

Once the database is created, you should be able to access it from your host via adminer by opening `http://localhost:8080` in your web browser.

You can then build and run the API by launching `build_api.bat`.
Its portal is located by default on port 42202.

These two scripts should be launched only once, except if you're making modifications to their files.

## Usage

All responses will have the form

```json
{
  "message": "Description of what happened",
  "data": "Mixed type holding the content of the response"
}
```

SUbsequence response definitions will only detail the expected value of the `data` field.

### List all nodes

**Definition**

`GET /nodes`

**Response**

- `200 OK` on success

```json
[
  {
    "pubkey": [
      "574609531198162337467611618954246488612764993482280962203923112386328222468611298942828658814490028486741492828721624185042437446314348023192178036635076342513518018059685280984137182087037535795117137620484746252429782181004259522589471457414466927240871979329576610269000851409871631975073925571731059252838139806573363146873491449787055984312795275529600048335413998004819956379520641521357029395829438101213114487309716894389940594547731569766288985053389755231983564941910446013080593475857149758308381809470253064811339283808721418099134474419644574205804355304979205636846248596058505934172599345162912714272346184695210096049662988558395732008656640220054160417005461794320986981613823603439940431037371430252457204908375047202094166125527601826833811097815386881385036702110741116440887505383704327008125442038820346329199727989746503193685664063536550043047684053138649493723317838073298243653309982884498775464620457689370643794524117621092652852786905075446942330829156706669029874711812210766587579231380957915290812999696860470250620402399027699700137010344902909029429242674876383379808545427503342857593036552348778134978480893298296831148063097250928353794280282623330841699328257756922344709760745382139201513672539",
      "65537"
    ],
    "address": "192.168.0.100:64523",
    "hash": "91a33d96f9f580907e0944f3cd49b7cd86d9eea0f150a59f41bdb2f2a7b096ca"
  },
  {
    "pubkey": [
      "796548893558100387551967975052291039749836707258022304358984235695026775298533623273645060143655118945374619478610047781254669921146021964453353542074120324206201772097793196713810982429549945924224161903857990770714983433963531429141102742481358880749777819783947103800038256767008181935671006536321702368669771359620346073520916881112427349572357353852984716509617090956220840823083447875120700006174945040681789717671540728068817179895584392824281567737023937438123009181768014961837662156631552936897719562218131694891066446845085861421987352112821650472857190283549960860970970063390285083627463371267915731370776268754966860601924218812302879477293476403535074217754232795657468381178443970681045163094501470190401216968372157440665176983267902338085855679859830383317186193220386138857123408106874421131872580615373715954548100947476921534314642514864007906115661886699883718044568089542748069525702731038106900438347758387372784826055644869784372048335111689320436835803678082516960567772062749960167189973196499165227608573285897034439567567703125782618459111557458262973900473346059922789090424513313164204761040820066000732162021740696384829261071827920066964613447868538826472166276236928633873190726074977616709967014333",
      "65537"
    ],
    "address": "192.168.0.50:577",
    "hash": "cd70a153b516d3ce28f0f7a70e19abf143be5c3830135cea7f8b1e7bbd8a5801"
  }
]
```

### Registering a new node

**Definition**

`POST /nodes`

**Arguments**

- `"pubkey_n":string` RSA publickey modulus.
- `"pubkey_e":string` RSA publickey public exponent.
- `"address":string` the IP address and port of the node.
- `"hash":string` hexdigest of the SHA256 hash of the public key.
- `"sig":string` signature of the above hash.

If a node with the given pubkey already exists, the existing node will be overwritten.

**Response**

- `201 Created` on success
- `400 Bad request` on invalid public key
- `401 Unauthorized` on invalid authentication

```json
{
  "pubkey": [
    "796548893558100387551967975052291039749836707258022304358984235695026775298533623273645060143655118945374619478610047781254669921146021964453353542074120324206201772097793196713810982429549945924224161903857990770714983433963531429141102742481358880749777819783947103800038256767008181935671006536321702368669771359620346073520916881112427349572357353852984716509617090956220840823083447875120700006174945040681789717671540728068817179895584392824281567737023937438123009181768014961837662156631552936897719562218131694891066446845085861421987352112821650472857190283549960860970970063390285083627463371267915731370776268754966860601924218812302879477293476403535074217754232795657468381178443970681045163094501470190401216968372157440665176983267902338085855679859830383317186193220386138857123408106874421131872580615373715954548100947476921534314642514864007906115661886699883718044568089542748069525702731038106900438347758387372784826055644869784372048335111689320436835803678082516960567772062749960167189973196499165227608573285897034439567567703125782618459111557458262973900473346059922789090424513313164204761040820066000732162021740696384829261071827920066964613447868538826472166276236928633873190726074977616709967014333",
    "65537"
  ],
  "address": "192.168.0.50:577",
  "hash": "cd70a153b516d3ce28f0f7a70e19abf143be5c3830135cea7f8b1e7bbd8a5801",
  "sig": "VJwD2jHHGxhIxFeIMedIJzDhVgKf4fGc7mUpRuME9pXZ3v3FnPu4i8aKlrKF9rRn65FhsrIAiLOaWukWr9beKtD/3M8fg195Aqn0yIJhJJvMXn8wupim4g4SbdCDpa0jhW8nJpQ4g0xt1gY+xDsK2zhepFJx0s56Q74xPknHmDPJgozte23qUoQdxEjkuFBdxsprM6T7LDl0YmDJ7GvlQtn6NjVFx+OGA7nrW4qjx9R4m+KeWMN+MPEt0fbqhI7jZqw27/vzxMDlXU+uj9c5s4Brb74OLCcZbEzBs7mUKBj1GOAUwVeN9G2c9+nKU5jeDJtUKraayJE78/y6KTTHEk/QZuUpn4tOIWDdTroUfSo5jMziAN0apYGuXTUjtglXmULduiN4aU3ErsmXtBQU+bJnnpP6k3WHVxHcbjETR9kOLhq8F9bjWk73miu2X42Dv7Y9p4tGrk3JfgWSRbqkGPq7+2cgoDF80VgD9WoaGkj1JXosX1WZ0VcTY/2vNxk/gxciPylTnGyH2F5nna/W8n00RdmH8EdIvYxwK5pkeZO2vpGoIwRKI5k5fNp/qICfB6Ib6+Gjkz/0qS4+7KCFXV5Iu8zyEMZOptz+EeEwXaWdHRK7ydK4/anTAO2+5cceXbJyFhl1IDnLMb49fVkqJ8bscJvMHr4ppsllVpjXRlU="
}
```
