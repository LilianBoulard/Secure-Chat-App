# Node Registering Service

## Important note

The system is still being designed !
Many features are lacking, and it is not secure to use it in production for now.
Come back in a few weeks for the final version of the project.

## Setup

The API is based on a Docker-hosted server and database.
You will therefore need to have Docker installed on your host.

First setup the database by modifying the DB's password in the file `nodes_registry_db/docker-composer.yml`, then running the `build_database.bat` script.
Docker's commands are cross-platform, meaning if you're not on Windows you can run the .bat's commands anyway.

Once the database is created, you should be able to access it from your host via adminer by opening `http://localhost:8080` in your web browser.

You can then build and run the API by launching `build_api.bat`.
Its portal is located by default on port 42202.

These two scripts should be launched only once, except if you're making modifications to their files.

## Usage

All responses will have the form

```json
{
  "message": "Description of what happened",
  "data": "Mixed type holding the content of the response"
}
```

SUbsequence response definitions will only detail the expected value of the `data` field.

### List all nodes

**Definition**

`GET /nodes`

**Response**

- `200 OK` on success

```json
[
  {
    "uuid": "6f064934359b2d1d",
    "pubkey": "PublicKey(574609531198162337467611618954246488612764993482280962203923112386328222468611298942828658814490028486741492828721624185042437446314348023192178036635076342513518018059685280984137182087037535795117137620484746252429782181004259522589471457414466927240871979329576610269000851409871631975073925571731059252838139806573363146873491449787055984312795275529600048335413998004819956379520641521357029395829438101213114487309716894389940594547731569766288985053389755231983564941910446013080593475857149758308381809470253064811339283808721418099134474419644574205804355304979205636846248596058505934172599345162912714272346184695210096049662988558395732008656640220054160417005461794320986981613823603439940431037371430252457204908375047202094166125527601826833811097815386881385036702110741116440887505383704327008125442038820346329199727989746503193685664063536550043047684053138649493723317838073298243653309982884498775464620457689370643794524117621092652852786905075446942330829156706669029874711812210766587579231380957915290812999696860470250620402399027699700137010344902909029429242674876383379808545427503342857593036552348778134978480893298296831148063097250928353794280282623330841699328257756922344709760745382139201513672539, 65537)",
    "address": "192.168.0.100",
    "port": 64523
  },
  {
    "uuid": "a6be055f35267e94",
    "pubkey": "PublicKey(796548893558100387551967975052291039749836707258022304358984235695026775298533623273645060143655118945374619478610047781254669921146021964453353542074120324206201772097793196713810982429549945924224161903857990770714983433963531429141102742481358880749777819783947103800038256767008181935671006536321702368669771359620346073520916881112427349572357353852984716509617090956220840823083447875120700006174945040681789717671540728068817179895584392824281567737023937438123009181768014961837662156631552936897719562218131694891066446845085861421987352112821650472857190283549960860970970063390285083627463371267915731370776268754966860601924218812302879477293476403535074217754232795657468381178443970681045163094501470190401216968372157440665176983267902338085855679859830383317186193220386138857123408106874421131872580615373715954548100947476921534314642514864007906115661886699883718044568089542748069525702731038106900438347758387372784826055644869784372048335111689320436835803678082516960567772062749960167189973196499165227608573285897034439567567703125782618459111557458262973900473346059922789090424513313164204761040820066000732162021740696384829261071827920066964613447868538826472166276236928633873190726074977616709967014333, 65537)",
    "address": "192.168.0.50",
    "port": 577
  }
]
```

### Registering a new node

**Definition**

`POST /nodes`

**Arguments**

- `"uuid":string` a globally unique identifier for this node, derived from the private key.
- `"pubkey":string` the RSA public key, as a Python object for the rsa module.
- `"address":string` the IP address of the node.
- `"port":integer` the port on which the node is listening

If a node with the given identifier already exists, the existing node will be overwritten.

**Response**

- `201 Created` on success

```json
{
  "uuid": "dd772ccbaf4fb3a7",
  "pubkey": "-----BEGIN RSA PUBLIC KEY-----MIICCgKCAgEAhp5+SRoXz6x4HvQSqqXHRFq85z2MIzteIWNEe2PqrkPXFtqCyAtTSKwbTHfd3XESk7qth1vdSlf63GIJbC6ReULvM3htK5/WaEq1Iy5X/kqdi+UJTo9IQaK3kzlpTBuMsxy+q16HLRTTvo0ruw2LmiW8Li4WfU0gXaRjCdL/m8/dLGe1rQMsUEPhqB56/tqx04LPUZae0+sICwt+FKtM1L6ENICBqJR6G2NDeEYBwDQ9GuN/T7QiQy1Fj7yXFGRTe8k4v9cOpwsTnLMDd26Lg3gfM9B1BBVMXu3HqHRjVn5Sj1UywLWtY47aJ0ecTOp68tT8teHm8zEMxwItPWThrXi1+xZJPhd/2wF23dIf3tzaYbHtPuLcDUBN/3daAejw2Oyr6vQK8pdd1D8mrUj0R7YrbU1waP2XOBRx6AwS3EHW0TfGFw4CkpkW9ibZ40PxhqPbSnQzMYmdmuhHgfSu8cDoCze14A8MYOaksWhFC+bBxMNxPrEVnlY2JvWfN8gtBqLsmAPRV0/JbClIrDaUEkuuqVmVA67Q8dFQiPrdSv+VgTI0LYpy+A4NvNAPRZPYEsUCJ2F0rg9Gesi54qvbqGO/9e/0mtmO0xyzkpjJwqzYrPfvJBhCK5Jpr46aaQ9iyv5JYVHVykLoZ46gjuwpn3dLOO5SaIw0RGH+9DKZK40CAwEAAQ==-----END RSA PUBLIC KEY-----",
  "address": "192.168.0.50",
  "port": 577
}
```

**Definition**

`GET /key`

**Response**

- `200 Created` on success

```json
{
    "message": "Public key gathered",
    "data": [
        "575783254949606748888478640800314301686075649844997283431989328379583425800454879754185536608944134262356202556961464943671009506734675785626519848243515933968283713728178706870494693479735609973860241218857520106276027987236387308173931930245804130665723299792510109540494038570496843227834062344488233261300446871354528999016121449081669288836887713599805570384614854405185399976815091524264974175369612383210271630390569422866184788283760734634282963400321677547353215616890061550256484564866561699418077742262603012624352777836447936479062945421161685697456427597717904267067695661821910308490266334597522950160600764966855469368322115438451861871835366117422531062525976045892558285382266157503858200549408837867944298203698903283595183141437118635000845379340998046530497181111668440393431023021319641501678950492509251902642857121801175564867989345231883425737667280123323022435115443501946797314330180229356698333219698309909678561038629997515160873529222856730292349720044832173116002796652190723352400168876110740052879440837385942998627068398273588923881464498089025638059489260330689575495410909418919193238194293077192319679524028010486289028067995286046973206239616516122876593006742904911941625657966419949494457262217",
        "65537"
    ]
}
```
